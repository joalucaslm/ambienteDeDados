<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste Frontend - AmbienteDeDados</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 15px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #764ba2; }
    .result {
      margin-top: 10px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 0.9rem;
    }
    .success { background: #d4edda; }
    .error { background: #f8d7da; }
  </style>
</head>
<body>
  <h1>üß™ Teste Frontend - AmbienteDeDados</h1>
  <p>Use os bot√µes abaixo para testar a integra√ß√£o com o backend.</p>

  <div class="test-section">
    <h2>1. Teste de Conex√£o</h2>
    <button onclick="testConnection()">Testar Conex√£o</button>
    <div id="test-connection" class="result"></div>
  </div>

  <div class="test-section">
    <h2>2. Listar Restaurantes</h2>
    <button onclick="testListRestaurants()">Carregar Restaurantes</button>
    <div id="test-restaurants" class="result"></div>
  </div>

  <div class="test-section">
    <h2>3. Registrar Novo Usu√°rio</h2>
    <input type="text" id="reg-nome" placeholder="Nome">
    <input type="email" id="reg-email" placeholder="Email">
    <input type="text" id="reg-telefone" placeholder="Telefone (11 d√≠gitos)">
    <input type="password" id="reg-senha" placeholder="Senha (m√≠n. 6 caracteres)">
    <button onclick="testRegister()">Registrar</button>
    <div id="test-register" class="result"></div>
  </div>

  <div class="test-section">
    <h2>4. Fazer Login</h2>
    <input type="email" id="login-email" placeholder="Email">
    <input type="password" id="login-senha" placeholder="Senha">
    <button onclick="testLogin()">Login</button>
    <div id="test-login" class="result"></div>
  </div>

  <div class="test-section">
    <h2>5. Visualizar Aplica√ß√£o</h2>
    <button onclick="openApp()">Abrir App Completo</button>
    <p>Abre o frontend em uma nova janela (certifique-se de que est√° servindo via HTTP server)</p>
  </div>

  <script>
    const API_URL = 'http://localhost:8080';

    async function apiCall(endpoint, method = 'GET', body = null) {
      const options = {
        method,
        headers: { 'Content-Type': 'application/json' }
      };
      if (body) options.body = JSON.stringify(body);
      const response = await fetch(`${API_URL}${endpoint}`, options);
      return response.json();
    }

    function showResult(elementId, data, isError = false) {
      const el = document.getElementById(elementId);
      el.textContent = JSON.stringify(data, null, 2);
      el.className = 'result ' + (isError ? 'error' : 'success');
    }

    async function testConnection() {
      try {
        const data = await apiCall('/restaurante');
        showResult('test-connection', { success: true, message: 'Conex√£o OK', endpoints: '/restaurante' });
      } catch (err) {
        showResult('test-connection', { error: err.message }, true);
      }
    }

    async function testListRestaurants() {
      try {
        const data = await apiCall('/restaurante');
        showResult('test-restaurants', data);
      } catch (err) {
        showResult('test-restaurants', { error: err.message }, true);
      }
    }

    async function testRegister() {
      const nome = document.getElementById('reg-nome').value;
      const email = document.getElementById('reg-email').value;
      const telefone = document.getElementById('reg-telefone').value;
      const senha = document.getElementById('reg-senha').value;

      if (!nome || !email || !telefone || !senha) {
        showResult('test-register', { error: 'Preencha todos os campos' }, true);
        return;
      }

      try {
        const data = await apiCall('/auth/register', 'POST', { nome, email, telefone, senha });
        showResult('test-register', data);
        if (data.success) {
          localStorage.setItem('token', data.data.token);
          document.getElementById('login-email').value = email;
          document.getElementById('login-senha').value = senha;
        }
      } catch (err) {
        showResult('test-register', { error: err.message }, true);
      }
    }

    async function testLogin() {
      const email = document.getElementById('login-email').value;
      const senha = document.getElementById('login-senha').value;

      if (!email || !senha) {
        showResult('test-login', { error: 'Preencha email e senha' }, true);
        return;
      }

      try {
        const data = await apiCall('/auth/login', 'POST', { email, senha });
        showResult('test-login', data);
        if (data.success) {
          localStorage.setItem('token', data.data.token);
          localStorage.setItem('user', JSON.stringify(data.data));
        }
      } catch (err) {
        showResult('test-login', { error: err.message }, true);
      }
    }

    function openApp() {
      // Tenta abrir o arquivo index.html
      window.open('./index.html', '_blank');
    }
  </script>
</body>
</html>
